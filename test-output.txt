
> alocubano-boulderfest@1.0.0 test
> npm run test:unit


> alocubano-boulderfest@1.0.0 test:unit
> vitest run --config vitest.config.js


 RUN  v3.2.4 /Users/damilola/Documents/Projects/alocubano.boulderfest

stdout | tests/unit/audit-logger.test.js
🧪 Test environment initialized
   Node.js version: v24.2.0
   Environment: test

stdout | tests/unit/analytics-service.test.js
🧪 Test environment initialized
   Node.js version: v24.2.0
   Environment: test

stderr | tests/unit/analytics-service.test.js
TestEnvironmentManager: No backup found, skipping restore

 ✓ tests/unit/analytics-service.test.js > AnalyticsService > getEventStatistics > should query using correct wallet columns (apple_pass_serial and google_pass_id) 4ms
 ✓ tests/unit/analytics-service.test.js > AnalyticsService > generateExecutiveSummary > should calculate wallet metrics correctly with actual schema columns 0ms
 × tests/unit/analytics-service.test.js > AnalyticsService > getWalletAnalytics > should query using correct wallet detection logic 4ms
   → expected "spy" to be called 3 times, but got 4 times
stderr | tests/unit/audit-logger.test.js
TestEnvironmentManager: No backup found, skipping restore

 ✓ tests/unit/audit-logger.test.js > AuditLogger > should sanitize sensitive context data 5ms
 × tests/unit/audit-logger.test.js > AuditLogger > should log an event successfully 5ms
   → expected 2 to be 1 // Object.is equality
 ✓ tests/unit/audit-logger.test.js > AuditLogger > should retrieve logs with filters 1ms

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 2 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/unit/analytics-service.test.js > AnalyticsService > getWalletAnalytics > should query using correct wallet detection logic
AssertionError: expected "spy" to be called 3 times, but got 4 times
 ❯ tests/unit/analytics-service.test.js:124:30
    122| 
    123|       // Verify all three queries were called
    124|       expect(mockDb.execute).toHaveBeenCalledTimes(3);
       |                              ^
    125| 
    126|       // Check that all queries use the correct wallet detection logic

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯

 FAIL  tests/unit/audit-logger.test.js > AuditLogger > should log an event successfully
AssertionError: expected 2 to be 1 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 2[39m

 ❯ tests/unit/audit-logger.test.js:51:31
     49|       .map((line) => JSON.parse(line));
     50| 
     51|     expect(logEntries.length).toBe(1);
       |                               ^
     52|     const entry = logEntries[0];
     53| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯


 Test Files  2 failed (57)
      Tests  2 failed | 4 passed (6)
   Start at  13:39:20
   Duration  447ms (transform 67ms, setup 121ms, collect 17ms, tests 12ms, environment 576ms, prepare 56ms)

close timed out after 10000ms
Tests closed successfully but something prevents Vite server from exiting
You can try to identify the cause by enabling "hanging-process" reporter. See https://vitest.dev/config/#reporters
