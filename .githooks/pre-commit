#!/bin/sh
#
# Pre-commit hook for A Lo Cubano Boulder Fest
# Runs linting and unit tests before allowing commits
#

set -e

echo "ğŸš€ Running pre-commit checks..."

# Check if we're in the right directory
if [ ! -f package.json ]; then
    echo "âŒ Error: Not in project root directory"
    exit 1
fi

# Stage 1: Linting
echo "ğŸ“ Stage 1: Running linter..."
if npm run lint; then
    echo "âœ… Linting passed"
else
    echo "âŒ Linting failed - please fix errors before committing"
    exit 1
fi

# Stage 2: Unit tests with coverage
echo "ğŸ§ª Stage 2: Running unit tests..."
if npm run test:unit; then
    echo "âœ… Unit tests passed"
else
    echo "âŒ Unit tests failed - please fix tests before committing"
    exit 1
fi

# Stage 3: Check for sensitive data (basic check)
echo "ğŸ”’ Stage 3: Checking for sensitive data..."
if git diff --cached --name-only | xargs grep -l -i -E "(api[_-]?key|password|secret|token)" 2>/dev/null | grep -v -E "(package*.json|jest*.js|README.md|\.md$)" || false; then
    echo "âš ï¸  WARNING: Potential sensitive data found in staged files"
    echo "Please review your changes and remove any secrets or API keys"
    exit 1
fi

echo "âœ… All pre-commit checks passed!"
echo "ğŸ’¡ Your commit is ready to proceed"