<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Compact Mode Toggle Integration</title>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/typography.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/admin-overrides.css">
    <link rel="stylesheet" href="/css/admin-test-mode.css">
    <script type="module" src="/js/theme-manager.js"></script>
</head>
<body class="admin-container">
    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#mode-toggle" class="skip-link">Skip to mode toggle</a>
    <a href="#registrations" class="skip-link">Skip to registrations</a>

    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div>
                <h1 class="admin-header-title">Admin Dashboard</h1>
                <p class="admin-header-subtitle">A Lo Cubano Boulder Fest - Festival Management & Analytics</p>
            </div>
            <div class="admin-header-actions">
                <!-- Compact Mode Toggle in Header -->
                <div id="header-mode-toggle"
                     class="compact-mode-toggle-init"
                     data-variant="header"
                     data-label="Data Mode"
                     data-show-label="false"
                     data-initial-mode="production">
                </div>

                <div id="header-event-selector-container"></div>
                <button class="admin-btn admin-btn-success" onclick="syncToSheets()">
                    <span>Sync to Sheets</span>
                </button>
                <button class="admin-btn admin-btn-primary" onclick="logout()">
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Admin Navigation -->
    <nav class="admin-navigation">
        <ul class="admin-nav-list">
            <li class="admin-nav-item">
                <a href="/admin" class="admin-nav-link">
                    <span>Portal</span>
                </a>
            </li>
            <li class="admin-nav-item">
                <a href="/admin/dashboard" class="admin-nav-link active">
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="admin-nav-item">
                <a href="/admin/tickets" class="admin-nav-link">
                    <span>Tickets</span>
                </a>
            </li>
            <li class="admin-nav-item">
                <a href="/admin/test-mode" class="admin-nav-link">
                    <span>Test Mode</span>
                </a>
            </li>
            <li class="admin-nav-item">
                <a href="/admin/analytics" class="admin-nav-link">
                    <span>Analytics</span>
                </a>
            </li>
        </ul>

        <!-- Event Selector -->
        <div id="event-selector-container"></div>
    </nav>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Statistics Grid -->
        <section class="admin-grid auto-fit" id="statsGrid" data-testid="dashboard-stats" role="region" aria-labelledby="stats-heading">
            <h2 id="stats-heading" class="visually-hidden">Dashboard Statistics</h2>

            <!-- REMOVED: Old Large Mode Toggle Card would be here -->
            <!-- This has been replaced by the compact toggle in the header -->

            <!-- Production/Test Stats Cards -->
            <div class="admin-stat-card production-data" id="total-tickets-card">
                <h3 class="stat-label">ðŸŽ¯ Production Total Tickets</h3>
                <div class="stat-number">247</div>
            </div>

            <div class="admin-stat-card production-data" id="checked-in-card">
                <h3 class="stat-label">ðŸŽ¯ Production Checked In</h3>
                <div class="stat-number">189</div>
                <div class="stat-label admin-mt-sm">77%</div>
            </div>

            <div class="admin-stat-card production-data" id="revenue-card">
                <h3 class="stat-label">ðŸŽ¯ Production Revenue</h3>
                <div class="stat-number">$18,492.50</div>
            </div>

            <div class="admin-stat-card production-data" id="orders-card">
                <h3 class="stat-label">ðŸŽ¯ Production Orders</h3>
                <div class="stat-number">156</div>
            </div>

            <div class="admin-stat-card production-data" id="vip-tickets-card">
                <h3 class="stat-label">ðŸŽ¯ Production VIP Tickets</h3>
                <div class="stat-number">23</div>
            </div>

            <div class="admin-stat-card production-data" id="workshop-tickets-card">
                <h3 class="stat-label">ðŸŽ¯ Production Workshop Tickets</h3>
                <div class="stat-number">64</div>
            </div>
        </section>

        <!-- Mode Status Indicator -->
        <div id="mode-status-indicator" class="admin-alert info" style="margin: var(--space-lg) 0;">
            <div class="alert-title">Current View Mode</div>
            <div class="alert-content">
                <span id="mode-status-text">Currently viewing <strong>Production</strong> data. This includes live festival information and real ticket sales.</span>
            </div>
        </div>
    </main>

    <!-- Registrations Section -->
    <div class="admin-card admin-mb-xl" id="registrations">
        <div class="admin-card-header">
            <h2 class="admin-card-title">Registrations</h2>
            <div class="admin-card-actions">
                <button class="admin-btn admin-btn-sm" onclick="exportToCSV()">
                    <span>Export CSV</span>
                </button>
            </div>
        </div>
        <div class="admin-card-body">
            <div id="registrationsTable" data-testid="registrations-table">
                <p class="admin-text-center admin-p-xl admin-text-muted">
                    Registration data would be displayed here based on the selected mode...
                </p>
            </div>
        </div>
    </div>

    <!-- Floating Mode Toggle (Alternative positioning) -->
    <div id="floating-mode-toggle"
         class="compact-mode-toggle-init"
         data-variant="floating"
         data-label="Quick Mode Switch"
         data-initial-mode="production"
         style="display: none;">
    </div>

    <!-- Scripts -->
    <script src="/js/compact-mode-toggle.js"></script>
    <script>
        // Demo data for different modes
        const demoData = {
            production: {
                totalTickets: 247,
                checkedIn: 189,
                revenue: 18492.50,
                orders: 156,
                vipTickets: 23,
                workshopTickets: 64,
                mode: 'Production'
            },
            test: {
                totalTickets: 15,
                checkedIn: 8,
                revenue: 750.00,
                orders: 12,
                vipTickets: 2,
                workshopTickets: 5,
                mode: 'Test'
            }
        };

        // Initialize toggles and set up mode change handling
        document.addEventListener('DOMContentLoaded', function() {
            // The toggles are auto-initialized by the CompactModeToggle script
            // We just need to listen for mode changes

            document.addEventListener('modeChange', function(event) {
                const { mode } = event.detail;
                updateDashboardData(mode);
            });

            // Optional: Show floating toggle on scroll
            let showFloatingToggle = false;
            window.addEventListener('scroll', function() {
                const shouldShow = window.scrollY > 200;
                if (shouldShow !== showFloatingToggle) {
                    showFloatingToggle = shouldShow;
                    const floatingToggle = document.getElementById('floating-mode-toggle');
                    floatingToggle.style.display = showFloatingToggle ? 'flex' : 'none';
                }
            });

            console.log('Dashboard integration initialized');
        });

        function updateDashboardData(mode) {
            const data = demoData[mode];
            const isTestMode = mode === 'test';

            // Update stat cards
            updateStatCard('total-tickets-card', data.totalTickets, data.mode, isTestMode);
            updateStatCard('checked-in-card', data.checkedIn, data.mode, isTestMode, Math.round((data.checkedIn / data.totalTickets) * 100) + '%');
            updateStatCard('revenue-card', '$' + data.revenue.toFixed(2), data.mode, isTestMode);
            updateStatCard('orders-card', data.orders, data.mode, isTestMode);
            updateStatCard('vip-tickets-card', data.vipTickets, data.mode, isTestMode);
            updateStatCard('workshop-tickets-card', data.workshopTickets, data.mode, isTestMode);

            // Update mode status indicator
            const modeStatusText = document.getElementById('mode-status-text');
            const modeStatusIndicator = document.getElementById('mode-status-indicator');

            if (isTestMode) {
                modeStatusText.innerHTML = 'Currently viewing <strong>Test</strong> data. This includes sample festival information and test ticket sales for development purposes.';
                modeStatusIndicator.className = 'admin-alert warning';
            } else {
                modeStatusText.innerHTML = 'Currently viewing <strong>Production</strong> data. This includes live festival information and real ticket sales.';
                modeStatusIndicator.className = 'admin-alert info';
            }

            // Update page body class for styling
            document.body.classList.toggle('admin-test-mode-active', isTestMode);

            console.log(`Dashboard updated for ${mode} mode`);
        }

        function updateStatCard(cardId, value, modeLabel, isTestMode, subtitle = null) {
            const card = document.getElementById(cardId);
            if (!card) return;

            const statNumber = card.querySelector('.stat-number');
            const statLabel = card.querySelector('.stat-label');
            const existingSubtitle = card.querySelector('.stat-label.admin-mt-sm');

            // Update value
            statNumber.textContent = value;

            // Update label
            const icon = isTestMode ? 'ðŸ§ª' : 'ðŸŽ¯';
            const labelText = statLabel.textContent.replace(/^[ðŸŽ¯ðŸ§ª]\s+\w+\s+/, `${icon} ${modeLabel} `);
            statLabel.textContent = labelText;

            // Update card class
            card.className = `admin-stat-card ${isTestMode ? 'test-data' : 'production-data'}`;

            // Add test badge if in test mode
            let testBadge = card.querySelector('.test-badge');
            if (isTestMode) {
                if (!testBadge) {
                    testBadge = document.createElement('div');
                    testBadge.className = 'test-badge';
                    testBadge.textContent = 'TEST';
                    card.appendChild(testBadge);
                }
            } else if (testBadge) {
                testBadge.remove();
            }

            // Update subtitle if provided
            if (subtitle) {
                if (existingSubtitle) {
                    existingSubtitle.textContent = subtitle;
                } else {
                    const subtitleEl = document.createElement('div');
                    subtitleEl.className = 'stat-label admin-mt-sm';
                    subtitleEl.textContent = subtitle;
                    card.appendChild(subtitleEl);
                }
            }
        }

        // Placeholder functions for existing functionality
        function syncToSheets() {
            alert('Sync to Sheets functionality would be implemented here');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                alert('Logout functionality would be implemented here');
            }
        }

        function exportToCSV() {
            alert('Export to CSV functionality would be implemented here');
        }
    </script>
</body>
</html>