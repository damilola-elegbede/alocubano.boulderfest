<!doctype html>
<html lang="en">
  <head>
    <!-- Inline theme detection to prevent FOUC -->
    <script>
      (function() {
        // Detect admin pages
        const path = window.location.pathname.toLowerCase();
        const isAdmin = path.includes('/admin') || path.includes('pages/admin');

        if (isAdmin) {
          // Admin pages always use dark theme
          document.documentElement.setAttribute('data-theme', 'dark');
        } else {
          // Main site: check user preference
          let stored = null;
          try {
            stored = localStorage.getItem('theme-preference');
          } catch {
            // localStorage might be disabled
          }

          const preference = stored || 'system';
          let theme = preference;

          if (preference === 'system') {
            // Detect system preference
            theme = (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)
              ? 'dark'
              : 'light';
          }

          document.documentElement.setAttribute('data-theme', theme);
        }
      })();
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>404 - Page Not Found | A Lo Cubano Boulder Fest</title>
    <meta
      name="description"
      content="Page not found. Return to A Lo Cubano Boulder Fest home page."
    />

    <!-- Favicons -->
    <link
      rel="icon"
      type="image/png"
      href="/images/favicons/favicon-32x32.png"
    />
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />

    <!-- Critical resource preloading -->
    <script>
      // AVIF support detection function
      function supportsAVIF() {
        return new Promise((resolve) => {
          const img = new Image();
          img.onload = () => resolve(true);
          img.onerror = () => resolve(false);
          img.src =
            "data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgABogQEAwgMg8f8D///8WfhwB8+ErK42A=";
        });
      }

      // Track current variant to prevent unnecessary re-preloading
      let currentVariant = null;
      let preloadLinksAdded = false;

      // Responsive image preloading with proper timing and deduplication
      function preloadImages() {
        // Check if optimized variants exist for event heroes
        const heroPath = "/images/hero/hero-default.jpg";
        const isEventHero = false;

        if (isEventHero) {
          // Detect mobile after DOM is ready for accurate viewport
          const isMobile = window.innerWidth <= 768;
          const variant = isMobile ? "mobile" : "desktop";
          const baseName = "hero-default";

          // Skip re-preloading if variant hasn't changed
          if (currentVariant === variant && preloadLinksAdded) {
            return;
          }

          // Remove existing preload links to prevent accumulation
          const existingPreloads = document.head.querySelectorAll(
            'link[rel="preload"][href*="/images/hero-optimized/"]',
          );
          existingPreloads.forEach((link) => link.remove());

          // Update tracking variables
          currentVariant = variant;
          preloadLinksAdded = true;

          // Preload both mobile and desktop variants for critical content
          const variants = ["mobile", "desktop"];

          variants.forEach((variantType) => {
            // Preload WebP variant
            const webpPreload = document.createElement("link");
            webpPreload.rel = "preload";
            webpPreload.as = "image";
            webpPreload.href = `/images/hero-optimized/${variantType}/${baseName}.webp`;
            webpPreload.type = "image/webp";
            webpPreload.dataset.heroPreload = "true"; // Mark for easy identification
            document.head.appendChild(webpPreload);

            // Fallback JPEG preload
            const jpegPreload = document.createElement("link");
            jpegPreload.rel = "preload";
            jpegPreload.as = "image";
            jpegPreload.href = `/images/hero-optimized/${variantType}/${baseName}.jpg`;
            jpegPreload.type = "image/jpeg";
            jpegPreload.dataset.heroPreload = "true"; // Mark for easy identification
            document.head.appendChild(jpegPreload);
          });

          // Preload AVIF variant with proper detection
          supportsAVIF().then((supported) => {
            if (supported) {
              variants.forEach((variantType) => {
                const avifPreload = document.createElement("link");
                avifPreload.rel = "preload";
                avifPreload.as = "image";
                avifPreload.href = `/images/hero-optimized/${variantType}/${baseName}.avif`;
                avifPreload.type = "image/avif";
                avifPreload.dataset.heroPreload = "true"; // Mark for easy identification
                document.head.appendChild(avifPreload);
              });
            }
          });
        } else {
          // Standard hero image preload for top-level pages (only once)
          if (!preloadLinksAdded) {
            const heroPreload = document.createElement("link");
            heroPreload.rel = "preload";
            heroPreload.as = "image";
            heroPreload.href = heroPath;
            heroPreload.dataset.heroPreload = "true"; // Mark for easy identification
            document.head.appendChild(heroPreload);
            preloadLinksAdded = true;
          }
        }

        // Preload gallery data for gallery pages (only once)
        const pageId = window.location.pathname.split("/").pop() || "home";
        if (
          pageId.includes("gallery") &&
          !document.head.querySelector(
            'link[rel="preload"][href*="/api/gallery"]',
          )
        ) {
          const year = pageId.includes("2025")
            ? "2025"
            : new Date().getFullYear();
          const galleryDataPreload = document.createElement("link");
          galleryDataPreload.rel = "preload";
          galleryDataPreload.as = "fetch";
          galleryDataPreload.href = `/api/gallery?year=${year}&category=workshops`;
          galleryDataPreload.crossOrigin = "anonymous";
          galleryDataPreload.dataset.heroPreload = "true"; // Mark for easy identification
          document.head.appendChild(galleryDataPreload);
        }
      }

      // Wait for DOM to be ready before preloading
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", preloadImages);
      } else {
        preloadImages();
      }

      // Update variant on resize for dynamic responsiveness
      window.addEventListener("resize", () => {
        // Debounce resize events
        clearTimeout(window.resizeTimeout);
        window.resizeTimeout = setTimeout(() => {
          // Re-evaluate mobile detection and update if needed
          preloadImages();
        }, 250);
      });
    </script>

    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />

    <!-- Theme Management - Early inclusion to prevent FOUC -->
    <script type="module" src="/js/theme-manager.js"></script>

    <!-- Stylesheets -->
    <!-- Critical CSS (render-blocking) -->
    <link rel="stylesheet" href="/css/bundle-critical.css" />

    <!-- Deferred CSS (lazy-loaded) -->
    <link rel="stylesheet" href="/css/bundle-deferred.css" media="print" onload="this.media='all'">
    <noscript>
      <link rel="stylesheet" href="/css/bundle-deferred.css">
    </noscript>
  <style>
      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: var(--color-white);
        padding: var(--space-xl);
        margin: 0;
        font-family: var(--font-sans);
        text-align: center;
      }

      .error-container {
        max-width: 600px;
        animation: fadeIn 0.5s ease-out;
      }

      .logo-container {
        width: 150px;
        height: 56px;
        margin: 0 auto var(--space-xl);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .logo-container img {
        width: auto;
        height: 56px;
        object-fit: contain;
      }

      .error-code {
        font-size: var(--font-size-6xl);
        font-weight: 700;
        color: var(--color-red);
        margin-bottom: var(--space-md);
        font-family: var(--font-display);
      }

      .error-message {
        font-size: var(--font-size-xl);
        color: var(--color-black);
        margin-bottom: var(--space-lg);
        line-height: 1.5;
      }

      .error-description {
        font-size: var(--font-size-base);
        color: var(--color-black);
        opacity: 0.7;
        margin-bottom: var(--space-xl);
        line-height: 1.6;
      }

      .action-buttons {
        display: flex;
        gap: var(--space-md);
        justify-content: center;
        flex-wrap: wrap;
      }

      .btn {
        display: inline-block;
        padding: var(--space-md) var(--space-lg);
        background-color: var(--color-blue);
        color: var(--color-white);
        text-decoration: none;
        border-radius: 4px;
        font-weight: 600;
        transition: background-color 0.3s ease;
      }

      .btn:hover {
        background-color: var(--color-red);
      }

      .btn-secondary {
        background-color: transparent;
        color: var(--color-black);
        border: 2px solid var(--color-black);
      }

      .btn-secondary:hover {
        background-color: var(--color-black);
        color: var(--color-white);
      }

      .debug-info {
        margin-top: var(--space-xl);
        padding: var(--space-md);
        background-color: #f5f5f5;
        border-radius: 4px;
        font-size: var(--font-size-xs);
        color: #666;
        text-align: left;
        max-width: 100%;
        overflow-x: auto;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 600px) {
        .action-buttons {
          flex-direction: column;
          align-items: center;
        }

        .btn {
          width: 200px;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="error-container">
      <div class="logo-container">
        <img src="/images/logo.png" alt="A Lo Cubano Boulder Fest Logo" />
      </div>

      <div class="error-code">404</div>
      <div class="error-message">Page Not Found</div>
      <div class="error-description">
        The page you're looking for doesn't exist or may have been moved. Let's
        get you back to the festival!
      </div>

      <div class="action-buttons">
        <a href="/" class="btn">Go Home</a>
        <a href="/about" class="btn-secondary">About Festival</a>
        <a href="/tickets" class="btn-secondary">Get Tickets</a>
      </div>

      <div class="debug-info" id="debug-info">
        <strong>Debug Information:</strong><br />
        <span id="debug-details">Loading...</span>
      </div>
    </div>

    <script>
      // Debug logging for 404 troubleshooting
      console.log("404 Page loaded at:", new Date().toISOString());
      console.log("Current URL:", window.location.href);
      console.log("Pathname:", window.location.pathname);
      console.log("Search:", window.location.search);
      console.log("Hash:", window.location.hash);
      console.log("Referrer:", document.referrer);
      console.log("User Agent:", navigator.userAgent);

      // Display debug information on page
      document.addEventListener("DOMContentLoaded", () => {
        const debugElement = document.getElementById("debug-details");
        const debugInfo = {
          url: window.location.href,
          pathname: window.location.pathname,
          timestamp: new Date().toISOString(),
          referrer: document.referrer || "Direct access",
          userAgent: navigator.userAgent.substring(0, 100) + "...",
        };

        debugElement.innerHTML = Object.entries(debugInfo)
          .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
          .join("<br>");
      });

      // Test API endpoint to verify if backend is working
      fetch("/api/debug")
        .then((response) => response.json())
        .then((data) => {
          console.log("API debug endpoint working:", data);
        })
        .catch((error) => {
          console.error("API debug endpoint failed:", error);
        });
    </script>

    <!-- Theme Toggle -->
    <script type="module">
      import { initializeThemeToggle } from '/js/theme-toggle.js';
      document.addEventListener('DOMContentLoaded', () => {
        // Add floating theme toggle for special page
        const toggleContainer = document.createElement('div');
        toggleContainer.id = 'theme-toggle-container';
        toggleContainer.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 1000;';
        document.body.appendChild(toggleContainer);
        initializeThemeToggle('#theme-toggle-container');
      });
    </script>
  </body>
</html>
